/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("hcm.approve.leaverequest.util.Conversions");jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");jQuery.sap.require("sap.ca.ui.message.message");sap.ca.scfld.md.controller.ScfldMasterController.extend("hcm.approve.leaverequest.view.S2",{extHookChangeFooterButtons:null,onInit:function(){"use strict";this.resourceBundle=this.oApplicationFacade.getResourceBundle();this.oDataModel=this.oApplicationFacade.getODataModel();this._getData();this.registerMasterListBind(this.getList());this.aRequestFilterList=[];var c=sap.ui.core.Component.getOwnerIdFor(this.getView());var C=sap.ui.component(c);C.oEventBus.subscribe("hcm.approve.leaverequest","leaveRequestApproveReject",this._handleApproveRejectCallBack,this);this.oRouter.attachRoutePatternMatched(function(e){if(e.getParameter("name")==="detail"){var b=this.getBindingContextPathFor(e.getParameter("arguments"));var i=this.findItemByContextPath(b);var l=this.getList();var L=l.getItems().filter(function(a,d,f){return a.getVisible();});if(L.length>=2){var I=l.indexOfItem(i);if(I+1<L.length){this.oApplicationFacade._sNextDetailPath=L[I+1].getBindingContext(this.sModelName).getPath();}else{this.oApplicationFacade._sNextDetailPath=L[I-1].getBindingContext(this.sModelName).getPath();}}else{this.oApplicationFacade._sNextDetailPath=null;}}},this);},applySearchPattern:function(f){this.iCount=0;sap.ca.scfld.md.controller.ScfldMasterController.prototype.applySearchPattern.call(this,f);return this.iCount;},applySearchPatternToListItem:function(i,f){var d=this.oDataModel.getProperty(i.getBindingContext().sPath);if(this.aRequestFilterList.indexOf(d.RequestId)!==-1){return false;}var v=sap.ca.scfld.md.controller.ScfldMasterController.prototype.applySearchPatternToListItem.call(this,i,f);if(v){this.iCount++;}return v;},onDataLoaded:function(){this.aRequestFilterList=[];if(this.getList().getItems().length<1){if(!sap.ui.Device.system.phone){this.showEmptyView("DETAIL_TITLE","NO_ITEMS_AVAILABLE");}}},_handleApproveRejectCallBack:function(c,e,d){"use strict";var i=this.findItemByContextPath(this.oApplicationFacade._sNextDetailPath);if(i){this.setListItem(i);}else{if(this.getList().getItems().length>1){this.selectFirstItem();}else{this.showEmptyView("DETAIL_TITLE","NO_ITEMS_AVAILABLE");}}this.aRequestFilterList.push(d.RequestId);this._applyClientSideSearch();},_getData:function(){"use strict";var l=this.getList(),t=l.getItems()[0].clone(),p={},a=this;l.bindItems("/LeaveRequestSet",t);},getHeaderFooterOptions:function(){"use strict";var o={sI18NMasterTitle:"view.Master.title"};var m=new sap.ui.core.routing.HashChanger();var u=m.getHash();if(u.indexOf("Shell-runStandaloneApp")>=0){o.bSuppressBookmarkButton=true;}if(this.extHookChangeFooterButtons){o=this.extHookChangeFooterButtons(o);}return o;},_handleListSwipe:function(){"use strict";var t=this;var l=this.getList(),s=l.getSwipedItem(),c=s.getBindingContext(),o=c.getProperty("SAP__Origin"),r=c.getProperty("RequestId"),v=c.getProperty("Version"),d="PREPARE_APPROVE",T="dialog.success.approve",p={};l.swipeOut();var P="ApplyLeaveRequestDecision?RequestId='"+r+"'&Version="+v+"&Comment=''"+"&Decision='"+d+"'";p.context=null;p.success=function(){sap.ca.ui.message.showMessageToast(t.resourceBundle.getText(T));t.oDataModel.refresh(true);};p.error=jQuery.proxy(this._onRequestFailed,this);this.oDataModel.read(P,p);},_onRequestFailed:function(e){"use strict";sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e.message,details:e.response.body});}});
