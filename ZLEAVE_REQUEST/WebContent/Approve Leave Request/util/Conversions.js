/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("hcm.approve.leaverequest.util.Conversions");jQuery.sap.require("sap.ca.ui.model.format.DateFormat");jQuery.sap.require("hcm.approve.leaverequest.util.NumberFormatter");jQuery.sap.require("hcm.approve.leaverequest.Configuration");hcm.approve.leaverequest.util.Conversions=(function(){var _={};_.exist=true;return{formatterAbsenceDuration:function(A,a,b){var o,c,d;if(A===null||a===null||b===null){return"";}o=A;c=a;if(b){d=hcm.approve.leaverequest.util.NumberFormatter.formatNumberStripZerosDays(o);}else{d=hcm.approve.leaverequest.util.NumberFormatter.formatNumberStripZeros(c);}return d;},formatterAbsenceDurationUnit:function(A,a,b){var o,c,d;var B=hcm.approve.leaverequest.Configuration.oApplicationFacade.getResourceBundle();if(A===null||a===null||b===null){return"";}o=A;c=a;if(b){if(parseInt(o,10)===1){d=B.getText("util.Conversions.Day_Singular");}else{d=B.getText("util.Conversions.Days");}}else{if(parseInt(c,10)===1){d=B.getText("util.Conversions.Hour_Singular");}else{d=B.getText("util.Conversions.Hours");}}return d;},formatterAbsenceDurationAndUnit:function(A,a,b){var o,c,d;var B=hcm.approve.leaverequest.Configuration.oApplicationFacade.getResourceBundle();if(A===null||a===null||b===null){return"";}o=A;c=a;if(b){o=hcm.approve.leaverequest.util.NumberFormatter.formatNumberStripZerosDays(o);if(parseInt(o,10)===1){d=B.getText("util.Conversions.Value_Day_Singular",[o]);}else{d=B.getText("util.Conversions.Value_Days",[o]);}}else{c=hcm.approve.leaverequest.util.NumberFormatter.formatNumberStripZeros(c);if(parseInt(c,10)===1){d=B.getText("util.Conversions.Value_Hour_Singular",[c]);}else{d=B.getText("util.Conversions.Value_Hours",[c]);}}return d;},formatterListCancelStatus:function(l){var r="";var b=hcm.approve.leaverequest.Configuration.oApplicationFacade.getResourceBundle();if(l&&l.toString()==="3"){r=b.getText("view.List.CancellationStatus");}return r;},formatterHeaderCancelStatus:function(){var r="";if(arguments.length>0){var b=hcm.approve.leaverequest.Configuration.oApplicationFacade.getResourceBundle();if(arguments[0]&&(arguments[0]).toString()==="3"){return b.getText("view.Header.CancellationStatus");}}return r;},formatterCurrentBalanceVisible:function(c){var r=true;if(!c){r=false;}if(c&&c.toString()==="000"){r=false;}return r;},formatterDeductionVisible:function(d){var r=true;if(!d){r=false;}if(d==="0.00000"){r=false;}return r;},formatterCurrentBalance:function(C,a){var c=0,o=0,r=0,b=hcm.approve.leaverequest.Configuration.oApplicationFacade.getResourceBundle();if(C===null||!a===null){return"";}c=C;o=a;c=hcm.approve.leaverequest.util.NumberFormatter.formatNumberStripZeros(c);if(o&&o.toString()==="010"){if(parseInt(c,10)===1){r=b.getText("util.Conversions.Value_Day_Singular",[c]);}else{r=b.getText("util.Conversions.Value_Days",[c]);}}if(o&&o.toString()==="001"){if(parseInt(c,10)===1){r=b.getText("util.Conversions.Value_Hour_Singular",[c]);}else{r=b.getText("util.Conversions.Value_Hours",[c]);}}return r;},formatterEmployeeID:function(e){if(!e){return"";}return hcm.approve.leaverequest.Configuration.oApplicationFacade.getResourceBundle().getText("view.Header.EmployeeID",[e]);},formatterOverlapsVisible:function(o){var r=true;if(!o){r=false;}if(parseInt(o,10)===0){r=false;}return r;},formatterOverlaps:function(o){var r="",b=hcm.approve.leaverequest.Configuration.oApplicationFacade.getResourceBundle();if(parseInt(o,10)===1){r=b.getText("util.Conversions.OverlapSing",[o]);}else if(o>1){r=b.getText("util.Conversions.OverlapsPl",[o]);}return r;},formatterOverlapLink:function(o){var r="",b=hcm.approve.leaverequest.Configuration.oApplicationFacade.getResourceBundle();r=b.getText("util.Conversions.OverlapsPlLink");return r;},formatterTimestampToDate:function(t){var d,D;d=sap.ca.ui.model.format.DateFormat.getInstance({style:"short"});if(!t){return"";}if(typeof t==="string"){if(t.indexOf("Date")>=0){D=hcm.approve.leaverequest.util.Conversions.convertDateStringToDate(t);}else{D=hcm.approve.leaverequest.util.Conversions.convertTimestampToDate(t);}}else{D=new Date(t);}D=new Date(D.getUTCFullYear(),D.getUTCMonth(),D.getUTCDate());return d.formatDaysAgo(D);},formatterAbsenceDays3:function(S,a,E,b,A){var t,s,o,c,d,f;f=sap.ca.ui.model.format.DateFormat.getInstance({style:"full"});if(S===null||a===null||E===null||b===null||A===null){return"";}try{s=f.format(hcm.approve.leaverequest.util.Conversions.getDate(S),true);o=f.format(hcm.approve.leaverequest.util.Conversions.getDate(E),true);c=hcm.approve.leaverequest.util.Conversions.formatterTime(a);d=hcm.approve.leaverequest.util.Conversions.formatterTime(b);if(s===o){if(!A){if(c===d){t="";}else{t="   "+c+" - "+d;}}else{t="";}t=s+t;}else{t=s+" - "+o;}}catch(e){jQuery.sap.log.warning("failed",["formatterAbsenceDays3"],"approver.leaverequests.formatterAbsenceDays3");t="";}return t;},formatterAbsenceDays3Short:function(S,P,E,a,A){var t,s,o,b,c,d;if(S===null||P===null||E===null||a===null){return"";}d=sap.ca.ui.model.format.DateFormat.getInstance({style:"short"});try{s=d.format(hcm.approve.leaverequest.util.Conversions.getDate(S),true);o=d.format(hcm.approve.leaverequest.util.Conversions.getDate(E),true);b=hcm.approve.leaverequest.util.Conversions.formatterTime(P);c=hcm.approve.leaverequest.util.Conversions.formatterTime(a);if(s===o){if(!A){if(b===c){t="";}else{t="   "+b+" - "+c;}}else{t="";}t=s+t;}else{t=s+" - "+o;}}catch(e){jQuery.sap.log.warning("failed",["formatterAbsenceDays3Short"],"approver.leaverequests.formatterAbsenceDays3Short");t="";}return t;},formatterDate1:function(d){var f=sap.ca.ui.model.format.DateFormat.getDateInstance({pattern:"MMddYYYY"});var c=hcm.approve.leaverequest.util.Conversions.getDate(d);if(c){return f.format(c);}return"";},formatterDate2:function(d){var f=sap.ca.ui.model.format.DateFormat.getDateInstance({pattern:"YYYY-MM-ddThh:mm"}),c=hcm.approve.leaverequest.util.Conversions.getDate(d);if(c){return f.format(c);}return"";},formatterTimeDurationVisible:function(a){var r=false;if(a!==null){if(!a){r=true;}}return r;},formatterTime:function(t){if(t!==null){var H,a,M,b;try{if(t.ms){H=t.ms/(3600*1000);a=Math.floor(H);M=t.ms-(a*3600*1000);b=Math.floor(M/(60*1000));}else{a=t.substring(0,2)*1;b=t.substring(2,4)*1;}}catch(e){jQuery.sap.log.warning("failed to calculate time","formatting time",[hcm.approve.leaverequest.util.conversions]);}var h=a<10?"0"+a:a;var m=b<10?"0"+b:b;var i=h<12?"AM":"PM";if(h>12){return((h-12)+":"+m+""+i);}else{return(h+":"+m+""+i);}}return"";},formatterDurationTime:function(s,e){var S=hcm.approve.leaverequest.util.Conversions.formatterTime(s);var E=hcm.approve.leaverequest.util.Conversions.formatterTime(e);return(S+"  -  "+E);},formatterPT_Time:function(p){if(p===null||p.length!==6){return"";}var h=p.substring(0,2)*60*60*1000,m=p.substring(2,4)*60*1000,s=p.substring(4,6)*1000,r=h+m+s,d=new Date(),T=d.getTimezoneOffset()*60*1000,t=sap.ca.ui.model.format.DateFormat.getTimeInstance({style:"short"}).format(d,true),a=t.split(":"),A="",l=a[a.length-1],b="";d.setTime(r+T);if(d){if(isNaN(l)){b=l.split(" ");a[a.length-1]=b[0];A=" "+b[1];}return(a[0]+":"+a[1]+A);}},convertDateStringToDate:function(d){var s=d.indexOf("("),e=d.indexOf(")"),D=d.substring(s+1,e),o=new Date();o.setTime(D);return o;},convertTimestampToDate:function(t){var d=new Date(),D=null,T=new sap.ui.model.type.Date({source:{pattern:"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"},pattern:"yyyy,MM,dd",style:"medium"});d=T.formatValue(t,"string");D=new Date(d);return D;},convertUTCToLocalDate:function(d){d=hcm.approve.leaverequest.util.Conversions.getDate(d);var u=new Date();u.setUTCDate(d.getDate());u.setUTCFullYear(d.getFullYear());u.setUTCHours(d.getHours());u.setUTCMonth(d.getMonth());u.setUTCMinutes(d.getMinutes());u.setUTCSeconds(d.getSeconds());u.setUTCMilliseconds(d.getMilliseconds());return u;},convertLocalDateToUTC:function(v){var d=null,D=sap.ca.ui.model.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd'T'HH:mm:ss"});if(v instanceof Date){d=hcm.approve.leaverequest.util.Conversions.revertTimezoneOffset(v);}else if(typeof v==="string"){d=D.parse(v);}return d;},revertTimezoneOffset:function(v){var d,U,m,t,r;if(v instanceof Date){d=v;m=d.getTime();t=d.getTimezoneOffset()*60*1000;m=m+t;U=new Date(m);r=U;}else{r=v;}return r;},formatterNotesVisible:function(c){var v=false;if(c){v=true;}return v;},formatErrorDialog:function(e){var m="";var a="";if(e.response){m=e.response.statusText;var b=e.response.body;var i=b.indexOf("value");var c=b.substring(i).indexOf("}");if(c>-1){m=b.substring(i+8,i+c-1);}var d=b.indexOf("errordetails");var f=b.substring(d).indexOf("message");var g=b.substring(d+f).indexOf(",");if(g>-1){a=b.substring(d+f+10,d+f+g-1);}}var M={message:m,details:a,type:sap.ca.ui.message.Type.ERROR};sap.ca.ui.message.showMessageBox({type:M.type,message:M.message,details:M.details});},_parseNotes:function(n){try{var a=n.split("::NEW::");var r=[];var E={};var b,i,d,t,D;for(i=1;i<a.length;i++){E={};b=a[i].split("::::");E.Pernr=b[0];E.Author=b[1];E.Text=b[2];d=b[3].toString();t=b[4].toString();D=new Date(d.substring(0,4),parseInt(d.substring(4,6),10)-1,d.substring(6,8),t.substring(0,2),t.substring(2,4),t.substring(4,6));var o=sap.ca.ui.model.format.DateFormat.getDateTimeInstance({style:'medium'});E.Timestamp=o.format(D);r.push(E);}return{"NotesCollection":r};}catch(e){jQuery.sap.log.error("Failed to parse notes details in utils.Formatters._parsenotes with input"+n);}},_parseAttachments:function(a,R,m){try{var b=a.split("::NEW::");var r=[];var E={};var c,i,d,t,D;for(i=1;i<b.length;i++){E={};c=b[i].split("::::");E.FileName=c[0];E.FileType='';E.Contributor=c[2];d=c[3].toString();t=c[4].toString();D=new Date(d.substring(0,4),parseInt(d.substring(4,6),10)-1,d.substring(6,8),t.substring(0,2),t.substring(2,4),t.substring(4,6));var o=sap.ca.ui.model.format.DateFormat.getDateTimeInstance({style:'medium'});E.UploadedDate=o.format(D);E.DocumentId=c[5];E.Status=c[6];E.FilePath=c[7];E.FileSize=parseFloat(c[8],10);E.FileSizeDesc=c[9];E.MimeType=c[1];E.FileUrl=m.sServiceUrl+"/FileAttachmentSet(LeaveRequestId='"+R+"',ArchivDocId='"+c[5]+"',FileName='"+encodeURIComponent(E.FileName)+"')/$value";r.push(E);}return{"AttachmentsCollection":r};}catch(e){jQuery.sap.log.error("Failed to parse notes details in util.conversions._parseAttachments with input"+a);}},_parseOverlapPernr:function(s){try{if(s){var o=s.split("::NEW::");var r=[];var E={};var t,i,j,a="",O="";for(i=1;i<o.length;i++){E={};t=o[i].split("::::");for(j=1;j<t.length-2;j=j+2){E.Name=t[j-1];a=t[j-1]+", "+a;O=t[j]+" "+O;E.Pernr=t[1];r.push(E);}}return O;}}catch(e){jQuery.sap.log.error("Failed to parse notes details in utils.Formatters._parseOverlapList with input"+s);return"";}},_parseOverlapList:function(s){try{if(s){var o=s.split("::NEW::");var r=[];var E={};var t,i,j,a="",O="";for(i=1;i<o.length;i++){E={};t=o[i].split("::::");for(j=1;j<t.length-2;j=j+2){E.Name=t[j-1];a=t[j-1].trim()+", "+a;O=t[j]+" "+O;E.Pernr=t[1];r.push(E);}}a=a.substring(0,a.lastIndexOf(", "))+".";return a;}}catch(e){jQuery.sap.log.error("Failed to parse notes details in utils.Formatters._parseOverlapList with input"+s);return"";}},getDate:function(v){var d;if(v instanceof Date){d=v;}else{if(typeof v!=="string"&&!(v instanceof String)){return null;}if(v.substring(0,6)!=="/Date("||v.substring(v.length-2,v.length)!==")/"){return null;}var a=v.substring(6,6+v.length-8);d=new Date();d.setTime(a*1);}return d;}};}());
